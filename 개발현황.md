# 개발 현황 - CS AI 에이전트 프로젝트

**프로젝트명**: 투비네트웍스 글로벌 FAQ 자동 응답 시스템  
**생성일**: 2025-09-30  
**최종 업데이트**: 2025-10-02 17:30, Claude 업데이트  
**버전**: 4.0

---

## 📋 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [기술 스택 선정](#기술-스택-선정)
3. [개발 계획 및 Work Phase](#개발-계획-및-work-phase)
4. [현재 작업 상태](#현재-작업-상태)
5. [완료된 작업 목록](#완료된-작업-목록)
6. [테스트 결과](#테스트-결과)
7. [다음 단계](#다음-단계)

---

## 프로젝트 개요

### 목표
CS 사원의 수동 FAQ 응대를 AI 기반 자동 응답 시스템으로 전환

### 핵심 구조
```
[FAQ 수집] → [AI 에이전트 분석] → [답변 생성] 
  → [CS 검수] → [판매 채널 등록]
```

### 기대 효과
| 지표 | 현재 | 목표 | 개선 |
|------|------|------|------|
| 응답 시간 | 2시간 | 30분 | 75% ↓ |
| 처리량 | 30건/일 | 300건/일 | 10배 ↑ |
| CS 작업 | 100% | 20% | 80% ↓ |

---

## 기술 스택 선정

### 전체 아키텍처

```
질문 분석: Sentence-BERT + spaCy (15-20ms, $0)
    ↓
벡터 검색: Weaviate (50ms, $0)
    ↓
데이터 조회: MongoDB (10ms, $0)
    ↓
신뢰도 평가: Python 로직 (5ms, $0)
    ↓
답변 생성: Claude Sonnet 4 (2500ms, $45/월)
    ↓
CS 검수 UI: Next.js + shadcn/ui
```

### 비용 분석
- **개발 환경**: $0/월 (로컬 Docker)
- **Claude API**: $45/월 (예상, 900건 기준)
- **총 운영 비용**: $45/월

---

## 개발 계획 및 Work Phase

### 전체 일정

```
Phase 0: 요구사항 & 설계        [====✅====] 완료 (2025-09-30)
Phase 1: 인프라 구축            [====✅====] 완료 (2025-10-01)
Phase 2: 데이터 준비            [====✅====] 완료 (2025-10-02)
Phase 3: 벡터 DB & 서비스 구축  [====✅====] 완료 (2025-10-02)
Phase 4: Claude API 통합        [=========] 예정 (10/03~)
Phase 5: FastAPI 엔드포인트     [=========] 예정
Phase 6: CS UI 개발             [=========] 예정
Phase 7: 통합 테스트            [=========] 예정
Phase 8: 프로덕션 배포          [=========] 예정

범례: ✅ 완료  [ ] 예정
```

---

## 현재 작업 상태

### Phase 진행률

| Phase | 작업 내용 | 상태 | 진행률 | 완료일 |
|-------|-----------|------|--------|--------|
| Phase 0 | 요구사항 & 설계 | ✅ | 100% | 2025-09-30 |
| Phase 1 | 인프라 구축 | ✅ | 100% | 2025-10-01 |
| Phase 2 | 데이터 준비 | ✅ | 100% | 2025-10-02 |
| **Phase 3** | **벡터 DB & 서비스** | **✅** | **100%** | **2025-10-02** |
| Phase 4 | Claude API 통합 | 📅 | 0% | 10/03~ |
| Phase 5 | FastAPI 엔드포인트 | 📅 | 0% | 미정 |
| Phase 6 | CS UI 개발 | 📅 | 0% | 미정 |
| Phase 7 | 통합 테스트 | 📅 | 0% | 미정 |
| Phase 8 | 프로덕션 배포 | 📅 | 0% | 미정 |

**전체 진행률**: 44% (Phase 0~3 완료)

---

## 완료된 작업 목록

### ✅ Phase 0: 요구사항 & 설계 (2025-09-23 ~ 09-30)

**문서 작성** (9개):
- [x] 01_프로젝트_개요.md
- [x] 02_시스템_아키텍처.md
- [x] 03_기술스택_질문분석.md
- [x] 04_기술스택_벡터DB.md
- [x] 05_기술스택_NoSQL.md
- [x] 09_개발_계획.md
- [x] presentation/기술팀_공유_15분.md
- [x] README.md
- [x] 개발현황.md

**소요 시간**: 약 14시간

---

### ✅ Phase 1: 인프라 구축 (2025-10-01)

**Docker 환경**:
- [x] WSL 2 설치 및 활성화
- [x] Docker Desktop 설치
- [x] docker-compose.yml 작성
- [x] Weaviate 컨테이너 (포트 8081)
- [x] MongoDB 컨테이너 (포트 27017)
- [x] Redis 컨테이너 (포트 6379)
- [x] Mongo Express (포트 8082)

**Python 환경**:
- [x] Python 3.11.9 가상환경
- [x] requirements.txt 패키지 설치
- [x] GPU 환경 (RTX 3050, CUDA 12.6)
- [x] spaCy 한국어 모델
- [x] Sentence-BERT 모델

**소요 시간**: 약 2시간

---

### ✅ Phase 2: 데이터 준비 (2025-10-01 ~ 10-02)

**제품 데이터**:
- [x] Keychron 제품 160개 CSV 추출
- [x] products_keychron.csv 생성

**FAQ 데이터**:
- [x] 네이버 Commerce API 연동
- [x] 실제 고객 문의 100건 수집
- [x] faq_data_sample.csv 생성

**데이터베이스**:
- [x] MongoDB 스키마 설계 (4개 컬렉션)
- [x] 임포트 스크립트 작성

**소요 시간**: 약 7시간

---

### ✅ Phase 3: 벡터 DB & 서비스 구축 (2025-10-02) ⭐ NEW

#### 3-1. MongoDB Service 구현

**파일**: `backend/app/services/mongodb_service.py`

**주요 기능**:
- FAQ CRUD 작업
- 통계 조회
- 비동기 처리 (Motor)

**테스트 결과**:
```
✅ FAQ 저장: 성공
✅ FAQ 조회: 성공
✅ 통계 조회: 총 1,582개 (실제 운영 데이터 포함)
```

#### 3-2. Weaviate Service 구현

**파일**: `backend/app/services/weaviate_service.py`

**주요 기능**:
- FAQ 임베딩 생성 및 저장
- 유사 FAQ 검색 (벡터 검색)
- 하이브리드 검색 (벡터 + 키워드)
- 배치 업로드

**Weaviate v4 API 호환**:
- Property 클래스 사용
- DataType enum 적용
- Filter API 업데이트
- 자동 스키마 생성

**테스트 결과**:
```
✅ 배치 추가: 3/3 성공
✅ 유사 FAQ 검색: 유사도 0.84
✅ 하이브리드 검색: 3개 발견
```

#### 3-3. QuestionAnalyzer 구현 ⭐

**파일**: `backend/app/services/question_analyzer.py`

**주요 기능**:
1. **키워드 추출** (spaCy)
   - 명사, 고유명사, 동사 추출
   - 빈도 기반 정렬
   
2. **제품 코드 인식** (정규식)
   - 패턴: K10, Q13, PRO MAX 등
   - 75% 인식률
   
3. **카테고리 분류**
   - 배송/반품/교환/상품/환불/기타
   - 100% 정확도
   
4. **복잡도 계산**
   - 고복잡도 키워드 (0.5 가중치)
   - 텍스트 길이 (0.3 가중치)
   - 질문 개수 (0.2 가중치)
   
5. **임베딩 생성** (Sentence-BERT)
   - 768차원 벡터
   - GPU 가속 (RTX 3050)
   
6. **유사 FAQ 검색**
   - Weaviate 하이브리드 검색
   - 최소 점수 필터링 (0.5 이상)
   
7. **신뢰도 평가**
   - 평균 유사도 기반
   - 복잡도 패널티 적용
   - 전가 로직 (3가지 조건)

**테스트 결과 (4가지 시나리오)**:

| 시나리오 | 복잡도 | 유사도 | 신뢰도 | 전가 | 정확도 |
|---------|--------|--------|--------|------|--------|
| 배송 문의 | 0.10 (LOW) | 1.00 | 0.97 | NO | ✅ 100% |
| 반품 문의 | 0.10 (LOW) | 1.00 | 0.97 | NO | ✅ 100% |
| 블루투스 | 0.10 (LOW) | 1.00 | 0.97 | NO | ✅ 100% |
| 펌웨어 | 0.60 (MED) | 1.00 | 0.82 | NO | ✅ 100% |

**성능 지표**:
- 카테고리 분류: **100%** (4/4)
- 제품 코드 인식: **75%** (3/4)
- 평균 신뢰도: **0.93**
- 유사 FAQ 검색: 평균 점수 **1.00**

#### 3-4. 통합 테스트

**파일**: `backend/tests/test_services.py`

**테스트 범위**:
- MongoDB Service
- Weaviate Service
- QuestionAnalyzer
- 통합 플로우

**결과**:
```
✅ MongoDB 테스트: 4/4 통과
✅ Weaviate 테스트: 5/5 통과
✅ QuestionAnalyzer: 4/4 통과
✅ 통합 테스트: 5/5 통과

총: 18/18 통과 (100%)
```

#### 3-5. 문서 작성

**신규 문서**:
- [x] **08_신뢰도_평가_시스템.md** ⭐
  - 복잡도 판단 알고리즘 상세
  - 신뢰도 점수 계산 로직
  - 답변 전가 로직 (3가지 조건)
  - 성능 지표 및 개선 제안

**업데이트 문서**:
- [x] 개발현황.md (v4.0)
- [x] README.md (데이터 현황 업데이트)

**소요 시간**: 약 10시간

---

## 테스트 결과

### 전체 테스트 실행 (2025-10-02 16:30)

```bash
$ python tests/test_services.py
```

#### MongoDB Service

| 테스트 | 결과 | 비고 |
|--------|------|------|
| FAQ 저장 | ✅ | |
| FAQ 조회 | ✅ | |
| 통계 조회 | ✅ | 1,582개 |
| 데이터 정리 | ✅ | |

#### Weaviate Service

| 테스트 | 결과 | 비고 |
|--------|------|------|
| 배치 추가 | ✅ | 3/3 성공 |
| 총 개수 확인 | ✅ | 3개 |
| 유사 FAQ 검색 | ✅ | 유사도 0.84 |
| 하이브리드 검색 | ✅ | 3개 발견 |
| 데이터 정리 | ✅ | |

#### QuestionAnalyzer

| 테스트 케이스 | 카테고리 | 복잡도 | 신뢰도 | 결과 |
|--------------|---------|--------|--------|------|
| 단순 배송 문의 | 배송 ✅ | 0.10 ✅ | 0.97 ✅ | ✅ |
| 개봉 후 반품 | 반품 ✅ | 0.10 ✅ | 0.97 ✅ | ✅ |
| 블루투스 문제 | 상품 ✅ | 0.10 | 0.97 ✅ | ✅ |
| 펌웨어 업데이트 | 상품 ✅ | 0.60 | 0.82 ✅ | ✅ |

**정확도**:
- 카테고리 분류: **100%** (4/4)
- 제품 코드 인식: **75%** (3/4)
- 신뢰도 범위: 0.82 ~ 0.97

#### 통합 테스트

| 단계 | 결과 |
|------|------|
| MongoDB 저장 | ✅ |
| Weaviate 임베딩 저장 | ✅ |
| 유사 FAQ 검색 | ✅ (유사도 0.98) |
| MongoDB 조회 | ✅ |
| 데이터 정리 | ✅ |

### 발견된 이슈 및 개선점

#### 1. 복잡도 판단 과소평가
- **문제**: "블루투스 끊김" 문의가 LOW (0.10)로 분류
- **예상**: MEDIUM
- **원인**: HIGH_COMPLEXITY_KEYWORDS에 블루투스 관련 키워드 없음
- **해결**: 키워드 확장 필요 (08_신뢰도_평가_시스템.md 참조)

#### 2. 하이브리드 검색 필터링
- **문제**: 점수 0.00~0.05인 무관한 FAQ도 반환
- **해결**: 최소 점수 0.3 필터 추가 권장

#### 3. 제품 코드 인식률
- **현재**: 75% (3/4)
- **목표**: 90% 이상
- **해결**: 정규식 패턴 확장

---

## 다음 단계

### 📅 Phase 4: Claude API 통합 (2025-10-03 ~)

#### 목표
Claude API를 사용한 답변 생성 시스템 구축

#### 주요 작업

**1. ClaudeService 클래스 구현**

**파일**: `backend/app/services/claude_service.py`

```python
class ClaudeService:
    """
    Claude API를 사용한 답변 생성 서비스
    
    주요 기능:
    1. 프롬프트 템플릿 관리
    2. Claude API 호출
    3. 답변 후처리
    4. 에러 핸들링
    """
    
    def __init__(self, api_key: str):
        self.client = anthropic.Anthropic(api_key=api_key)
        self.model = "claude-sonnet-4-20250514"
    
    async def generate_answer(
        self,
        inquiry: Dict[str, Any],
        similar_faqs: List[Dict[str, Any]],
        product_info: Optional[Dict[str, Any]] = None
    ) -> Dict[str, Any]:
        """
        답변 생성
        
        Args:
            inquiry: 고객 문의 정보
            similar_faqs: 유사 FAQ 리스트
            product_info: 제품 정보 (선택)
        
        Returns:
            {
                "answer": str,
                "confidence": float,
                "sources": List[str]
            }
        """
        pass
```

**2. 프롬프트 템플릿 작성**

**파일**: `backend/app/prompts/answer_generation.py`

```python
ANSWER_GENERATION_PROMPT = """
당신은 투비네트웍스 글로벌의 CS 전문가입니다.

# 고객 문의
{inquiry}

# 유사한 이전 FAQ (참고용)
{similar_faqs}

# 제품 정보
{product_info}

# 답변 작성 가이드
1. 친절하고 공감하는 톤
2. 구체적이고 실행 가능한 해결책
3. 필요시 단계별 안내
4. 이전 FAQ의 답변 스타일 참고

답변을 작성해주세요.
"""
```

**3. MCP 서버 설정** (선택)

MCP를 통해 MongoDB와 Weaviate에 직접 접근

**4. 테스트**

```python
def test_claude_answer_generation():
    """답변 생성 테스트"""
    service = ClaudeService(api_key="...")
    
    inquiry = {
        "title": "배송 문의",
        "content": "주문한 키보드 언제 배송되나요?"
    }
    
    similar_faqs = [
        {
            "question": "배송 얼마나 걸리나요?",
            "answer": "영업일 기준 2-3일 소요됩니다"
        }
    ]
    
    result = await service.generate_answer(inquiry, similar_faqs)
    
    assert "answer" in result
    assert len(result["answer"]) > 0
    assert result["confidence"] > 0.0
```

**체크리스트**:
- [ ] ClaudeService 클래스 구현
- [ ] 프롬프트 템플릿 3종 작성
  - 단순 문의용
  - 기술 지원용
  - 반품/교환용
- [ ] API 호출 최적화
- [ ] 에러 핸들링
- [ ] 재시도 로직
- [ ] 응답 캐싱 (Redis)
- [ ] 단위 테스트 10개
- [ ] 통합 테스트
- [ ] 비용 측정
- [ ] 문서 업데이트

**예상 소요 시간**: 1주

---

## 빠른 참조

### Docker 서비스

- **Weaviate**: http://localhost:8081
- **MongoDB**: mongodb://localhost:27017
- **Redis**: http://localhost:6379
- **Mongo Express**: http://localhost:8082

### 데이터 현황 (2025-10-02 17:30)

```
MongoDB:
  - products: 160개 ✅
  - faqs: 1,582개 ✅ (실제 운영 데이터)
  - customers: 0개
  - logs: 0개

Weaviate:
  - FAQ 벡터: 100개 ✅ (테스트 데이터)
  - 임베딩 차원: 768
  - 검색 가능: Yes ✅

Performance:
  - QuestionAnalyzer: ~20ms
  - Weaviate 검색: ~50ms
  - 전체 분석: ~70ms ✅
```

### 테스트 실행

```bash
# 전체 테스트
cd backend/tests
python test_services.py

# QuestionAnalyzer만
python test_services.py --analyzer-only
```

---

## 누적 작업 시간

| Phase | 소요 시간 |
|-------|-----------|
| Phase 0 | 14시간 |
| Phase 1 | 2시간 |
| Phase 2 | 7시간 |
| Phase 3 | 10시간 |
| **총합** | **33시간** |

---

**문서 버전**: 4.0  
**관리자**: 개발팀  
**최종 업데이트**: 2025-10-02 17:30, Claude  
**다음 업데이트**: Phase 4 완료 시
